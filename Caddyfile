{
    auto_https off
}

:80 {
    root * /app/public

    # Routes SSE avec timeout étendu
    route /api/session/*/stream {
        php_fastcgi unix//run/php/php.sock {
            read_timeout 600s  # 10 minutes pour SSE
        }
    }

    # Route PHP normale
    php_fastcgi unix//run/php/php.sock {
        read_timeout 60s  # 60 secondes pour requêtes normales
    }

    file_server

    mercure {
        transport_url http://mercure:3000/.well-known/mercure
        publisher_jwt "SUPER_SECRET_PUBLISHER"
        subscriber_jwt "SUPER_SECRET_SUBSCRIBER"
        anonymous
    }
}

srv802003.hstgr.cloud {
    root * /app/public

    # Routes SSE avec timeout étendu
    route /api/session/*/stream {
        php_fastcgi unix//run/php/php.sock {
            read_timeout 600s  # 10 minutes pour SSE
        }
    }

    # Route PHP normale
    php_fastcgi unix//run/php/php.sock {
        read_timeout 60s  # 60 secondes pour requêtes normales
    }

    file_server

    # Proxy Mercure pour le frontend
    route /.well-known/mercure* {
        reverse_proxy mercure:3000 {
            flush_interval -1  # obligatoire pour SSE
        }
    }
}
