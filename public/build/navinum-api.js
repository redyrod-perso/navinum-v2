!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.NavinumAPI=e():t.NavinumAPI=e()}(this,()=>(()=>{"use strict";var t={d:(e,s)=>{for(var r in s)t.o(s,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>w});class s{constructor(t={}){this.baseURL=t.baseURL||window.location.origin,this.timeout=t.timeout||3e4,this.headers=t.headers||{"Content-Type":"application/json",Accept:"application/json"},this.debug=t.debug||!1,this.retryAttempts=t.retryAttempts||3,this.retryDelay=t.retryDelay||2e3}log(...t){this.debug&&console.log("[Navinum API]",...t)}mergeHeaders(t={}){return{...this.headers,...t}}}class r extends Error{constructor(t,e=null,s=null){super(t),this.name="NavinumAPIError",this.status=e,this.response=s,this.timestamp=(new Date).toISOString()}toJSON(){return{name:this.name,message:this.message,status:this.status,timestamp:this.timestamp}}}class n extends r{constructor(t,e=null){super(t,null,null),this.name="NetworkError",this.originalError=e}}class i extends r{constructor(t,e={}){super(t,400,e),this.name="ValidationError",this.errors=e}}class a extends r{constructor(t="Non autorisé"){super(t,401,null),this.name="UnauthorizedError"}}class o extends r{constructor(t="Ressource non trouvée"){super(t,404,null),this.name="NotFoundError"}}class c extends r{constructor(t="Erreur serveur",e=500){super(t,e,null),this.name="ServerError"}}class h{constructor(t){this.config=t,this.requestInterceptors=[],this.responseInterceptors=[]}addRequestInterceptor(t){this.requestInterceptors.push(t)}addResponseInterceptor(t){this.responseInterceptors.push(t)}async runRequestInterceptors(t){let e={...t};for(const t of this.requestInterceptors)e=await t(e);return e}async runResponseInterceptors(t){let e=t;for(const t of this.responseInterceptors)e=await t(e);return e}buildURL(t,e={}){const s=new URL(t,this.config.baseURL);return Object.keys(e).forEach(t=>{null!==e[t]&&void 0!==e[t]&&s.searchParams.append(t,e[t])}),s.toString()}handleError(t,e){switch(t){case 400:throw new i(e?.message||"Données invalides",e?.errors||{});case 401:throw new a(e?.message);case 404:throw new o(e?.message);case 500:case 502:case 503:throw new c(e?.message||"Erreur serveur",t);default:throw new r(e?.message||`Erreur HTTP ${t}`,t,e)}}async requestWithRetry(t,e,s=null,r={},i=1){try{return await this.executeRequest(t,e,s,r)}catch(a){if(a instanceof n&&i<this.config.retryAttempts)return this.config.log(`Retry ${i}/${this.config.retryAttempts-1} après ${this.config.retryDelay}ms...`),await new Promise(t=>setTimeout(t,this.config.retryDelay)),this.requestWithRetry(t,e,s,r,i+1);throw a}}async executeRequest(t,e,s=null,i={}){const{params:a={},headers:o={},...c}=i;let h={method:t,headers:this.config.mergeHeaders(o),...c};!s||"POST"!==t&&"PUT"!==t&&"PATCH"!==t||(h.body=JSON.stringify(s)),h=await this.runRequestInterceptors(h);const u=this.buildURL(e,a);this.config.log(`${t} ${u}`,s);try{const t=new AbortController,e=setTimeout(()=>t.abort(),this.config.timeout),s=await fetch(u,{...h,signal:t.signal});clearTimeout(e),this.config.log(`Response ${s.status}:`,s);let r=null;const n=s.headers.get("content-type");return r=n&&n.includes("application/json")?await s.json():await s.text(),s.ok||this.handleError(s.status,r),r=await this.runResponseInterceptors(r),r}catch(t){if("AbortError"===t.name)throw new n(`Timeout après ${this.config.timeout}ms`,t);if(t instanceof r)throw t;throw new n("Erreur de connexion au serveur",t)}}async get(t,e={}){return this.requestWithRetry("GET",t,null,e)}async post(t,e=null,s={}){return this.requestWithRetry("POST",t,e,s)}async put(t,e=null,s={}){return this.requestWithRetry("PUT",t,e,s)}async patch(t,e=null,s={}){return this.requestWithRetry("PATCH",t,e,s)}async delete(t,e={}){return this.requestWithRetry("DELETE",t,null,e)}}class u{constructor(t,e,s={}){this.client=t,this.resourceName=e,this.basePath=s.basePath||`/api/${e}`}async getAll(t={}){return this.client.get(this.basePath,{params:t})}async getById(t){return this.client.get(`${this.basePath}/${t}`)}async create(t){return this.client.post(this.basePath,t)}async update(t,e){return this.client.put(`${this.basePath}/${t}`,e)}async patch(t,e){return this.client.patch(`${this.basePath}/${t}`,e)}async delete(t){return this.client.delete(`${this.basePath}/${t}`)}}class l extends u{constructor(t){super(t,"session",{basePath:"/api/session"})}async create(t){return this.client.post("/api/session/create",t)}async join(t,e){return this.client.post(`/api/session/${t}/join`,e)}async leave(t,e){return this.client.post(`/api/session/${t}/leave`,e)}async start(t,e){return this.client.post(`/api/session/${t}/start`,e)}async updateScore(t,e){return this.client.post(`/api/session/${t}/score`,e)}async reset(t){return this.client.post(`/api/session/${t}/reset`)}async clearAll(){return this.client.post("/api/sessions/clear")}async get(t){return this.client.get(`/api/session/${t}`)}}class p extends u{constructor(t){super(t,"exposition",{basePath:"/api/expositions"})}async getActive(){return this.client.get(`${this.basePath}/active`)}async search(t){return this.client.get(this.basePath,{params:t})}}class d extends u{constructor(t){super(t,"parcours",{basePath:"/api/parcours"})}async getByExposition(t){return this.client.get(`${this.basePath}`,{params:{exposition:t}})}}class y extends u{constructor(t){super(t,"interactif",{basePath:"/api/interactifs"})}async getByParcours(t){return this.client.get(`${this.basePath}`,{params:{parcours:t}})}async logInteraction(t,e){return this.client.post(`${this.basePath}/${t}/interact`,e)}}class g extends u{constructor(t){super(t,"visiteur",{basePath:"/api/visiteurs"})}async getByRfid(t){return this.client.get(`${this.basePath}/rfid/${t}`)}async register(t){return this.client.post(`${this.basePath}/register`,t)}}class m extends u{constructor(t){super(t,"rfid",{basePath:"/api/rfid"})}async scan(t){return this.client.post(`${this.basePath}/scan`,{tagId:t})}async associate(t,e){return this.client.post(`${this.basePath}/${t}/associate`,e)}}class f extends u{constructor(t){super(t,"log_visite",{basePath:"/api/log-visites"})}async track(t){return this.client.post(`${this.basePath}/track`,{...t,timestamp:t.timestamp||(new Date).toISOString()})}async getByVisiteur(t,e={}){return this.client.get(`${this.basePath}/visiteur/${t}`,{params:e})}async getStats(t={}){return this.client.get(`${this.basePath}/stats`,{params:t})}}class b{constructor(t={}){this.config=new s(t),this.client=new h(this.config),this.sessions=new l(this.client),this.expositions=new p(this.client),this.parcours=new d(this.client),this.interactifs=new y(this.client),this.visiteurs=new g(this.client),this.rfid=new m(this.client),this.logVisites=new f(this.client)}addRequestInterceptor(t){this.client.addRequestInterceptor(t)}addResponseInterceptor(t){this.client.addResponseInterceptor(t)}setDebug(t){this.config.debug=t}setBaseURL(t){this.config.baseURL=t}}b.NavinumAPIError=r,b.NetworkError=n,b.ValidationError=i,b.UnauthorizedError=a,b.NotFoundError=o,b.ServerError=c;const w=b;return e.default})());
//# sourceMappingURL=navinum-api.min.js.map